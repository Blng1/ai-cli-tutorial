<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>07 进阶实战 - AI CLI 工具通识教学</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;600&family=DM+Serif+Display&display=swap');

  :root {
    --bg: #060a12;
    --bg-raised: #0b1120;
    --bg-card: #0f1628;
    --bg-card-alt: #0a0f1e;
    --border: #192240;
    --border-focus: #2a4080;
    --blue: #4a9eff;
    --cyan: #22d3ee;
    --purple: #a78bfa;
    --green: #34d399;
    --orange: #fbbf24;
    --red: #f87171;
    --pink: #f472b6;
    --teal: #2dd4bf;
    --text: #dce4f0;
    --text2: #8295b5;
    --text3: #4a5f80;
  }

  /* ===== Reset ===== */
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans SC', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.75;
  }

  /* ===== Hero ===== */
  .hero {
    text-align: center;
    padding: 80px 32px 56px;
    border-bottom: 1px solid var(--border);
    position: relative;
    overflow: hidden;
  }

  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse 50% 40% at 30% 10%, rgba(74,158,255,0.06) 0%, transparent 70%),
      radial-gradient(ellipse 40% 50% at 70% 90%, rgba(167,139,250,0.04) 0%, transparent 70%);
  }

  .hero-tag {
    display: inline-block;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--cyan);
    background: rgba(34,211,238,0.08);
    border: 1px solid rgba(34,211,238,0.2);
    padding: 5px 16px;
    border-radius: 30px;
    margin-bottom: 20px;
    position: relative;
  }

  .hero h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 2.8rem;
    position: relative;
    background: linear-gradient(135deg, #dce4f0 20%, #4a9eff 50%, #a78bfa 80%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 14px;
  }

  .hero p {
    font-size: 0.95rem;
    color: var(--text2);
    position: relative;
    max-width: 720px;
    margin: 0 auto;
    line-height: 1.8;
  }

  /* ===== Container / Section ===== */
  .container { max-width: 1340px; margin: 0 auto; padding: 48px 28px; }
  .section { margin-bottom: 64px; }

  .section-head {
    display: flex;
    align-items: baseline;
    gap: 14px;
    margin-bottom: 10px;
  }

  .sn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    font-weight: 600;
    color: var(--cyan);
    background: rgba(34,211,238,0.08);
    border: 1px solid rgba(34,211,238,0.2);
    padding: 3px 10px;
    border-radius: 5px;
  }

  .st { font-size: 1.5rem; font-weight: 700; }

  .sd {
    color: var(--text2);
    font-size: 0.88rem;
    margin-bottom: 26px;
    max-width: 940px;
    border-left: 3px solid var(--border);
    padding-left: 16px;
  }

  /* ===== Card ===== */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 14px;
    overflow: hidden;
    margin-bottom: 24px;
    transition: border-color 0.3s;
  }

  .card:hover { border-color: var(--border-focus); }

  .card-head {
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    background: var(--bg-card-alt);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .card-head h3 { font-size: 1rem; font-weight: 600; }

  .card-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.62rem;
    padding: 3px 10px;
    border-radius: 4px;
    background: rgba(74,158,255,0.1);
    color: var(--blue);
    border: 1px solid rgba(74,158,255,0.2);
  }

  .card-body { padding: 24px; }

  .card-note {
    font-size: 0.8rem;
    color: var(--text3);
    margin-bottom: 18px;
    font-style: italic;
  }

  /* ===== Compare Table ===== */
  .compare-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.82rem;
  }

  .compare-table thead th {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text2);
    background: var(--bg-card-alt);
    padding: 14px 16px;
    text-align: left;
    border-bottom: 2px solid var(--border);
    white-space: nowrap;
  }

  .compare-table thead th:first-child { border-radius: 8px 0 0 0; }
  .compare-table thead th:last-child { border-radius: 0 8px 0 0; }

  .compare-table tbody td {
    padding: 12px 16px;
    border-bottom: 1px solid rgba(25,34,64,0.5);
    color: var(--text2);
    vertical-align: top;
  }

  .compare-table tbody td:first-child {
    font-weight: 600;
    color: var(--text);
    white-space: nowrap;
  }

  .compare-table tbody tr:hover td { background: rgba(74,158,255,0.03); }
  .compare-table tbody tr:last-child td { border-bottom: none; }

  .compare-table .dim { color: var(--text3); font-weight: 400; }
  .compare-table .highlight { color: var(--green); font-weight: 500; }
  .compare-table .warn { color: var(--orange); font-weight: 500; }

  /* ===== Insight ===== */
  .insight {
    background: linear-gradient(135deg, rgba(74,158,255,0.05), rgba(167,139,250,0.05));
    border: 1px solid rgba(74,158,255,0.18);
    border-radius: 12px;
    padding: 22px 26px;
    margin: 24px 0;
  }

  .insight h4 {
    font-size: 0.88rem;
    font-weight: 700;
    color: var(--blue);
    margin-bottom: 8px;
  }

  .insight p {
    font-size: 0.84rem;
    color: var(--text2);
    line-height: 1.7;
  }

  /* ===== Op Grid ===== */
  .op-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 16px;
  }

  .op-card {
    background: var(--bg-card-alt);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    transition: border-color 0.3s;
    position: relative;
    overflow: hidden;
  }

  .op-card:hover { border-color: var(--border-focus); }

  .op-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
  }

  .op-card.cat-blue::before { background: linear-gradient(90deg, var(--blue), rgba(74,158,255,0.2)); }
  .op-card.cat-purple::before { background: linear-gradient(90deg, var(--purple), rgba(167,139,250,0.2)); }
  .op-card.cat-green::before { background: linear-gradient(90deg, var(--green), rgba(52,211,153,0.2)); }
  .op-card.cat-orange::before { background: linear-gradient(90deg, var(--orange), rgba(251,191,36,0.2)); }
  .op-card.cat-cyan::before { background: linear-gradient(90deg, var(--cyan), rgba(34,211,238,0.2)); }
  .op-card.cat-pink::before { background: linear-gradient(90deg, var(--pink), rgba(244,114,182,0.2)); }

  .op-card h4 {
    font-size: 0.88rem;
    font-weight: 600;
    margin-bottom: 12px;
    color: var(--text);
  }

  .op-card p {
    font-size: 0.8rem;
    color: var(--text2);
    line-height: 1.6;
  }

  /* ===== Op List ===== */
  .op-list {
    list-style: none;
    padding: 0;
  }

  .op-list li {
    padding: 10px 0;
    border-bottom: 1px solid rgba(25,34,64,0.4);
    font-size: 0.82rem;
    color: var(--text2);
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  .op-list li:last-child { border-bottom: none; }

  .op-name {
    font-weight: 600;
    color: var(--text);
  }

  .op-desc {
    color: var(--text2);
    font-size: 0.78rem;
  }

  .freq-high {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: var(--green);
    background: rgba(52,211,153,0.08);
    border: 1px solid rgba(52,211,153,0.2);
    padding: 1px 6px;
    border-radius: 3px;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .freq-mid {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: var(--blue);
    background: rgba(74,158,255,0.08);
    border: 1px solid rgba(74,158,255,0.2);
    padding: 1px 6px;
    border-radius: 3px;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .freq-low {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: var(--text3);
    background: rgba(74,95,128,0.08);
    border: 1px solid rgba(74,95,128,0.2);
    padding: 1px 6px;
    border-radius: 3px;
    flex-shrink: 0;
    margin-top: 2px;
  }

  /* ===== Spec Block ===== */
  .spec-block {
    background: #080c18;
    border: 1px solid rgba(25,34,64,0.8);
    border-radius: 10px;
    overflow: hidden;
    margin: 16px 0;
  }

  .spec-block-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 18px;
    background: rgba(15,22,40,0.8);
    border-bottom: 1px solid rgba(25,34,64,0.6);
  }

  .spec-block-head span {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--text3);
  }

  .spec-block-head .spec-lang {
    color: var(--cyan);
    background: rgba(34,211,238,0.08);
    border: 1px solid rgba(34,211,238,0.15);
    padding: 2px 8px;
    border-radius: 3px;
  }

  .spec-block pre {
    padding: 18px 20px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem;
    line-height: 1.7;
    color: var(--text2);
    overflow-x: auto;
    white-space: pre;
  }

  .spec-block pre .key { color: var(--blue); font-weight: 600; }
  .spec-block pre .str { color: var(--orange); }
  .spec-block pre .num { color: var(--cyan); }
  .spec-block pre .comment { color: var(--text3); }
  .spec-block pre .keyword { color: var(--purple); }
  .spec-block pre .value { color: var(--green); }

  /* ===== Mermaid ===== */
  .mermaid {
    display: flex;
    justify-content: center;
    background: rgba(0,0,0,0.3);
    border-radius: 10px;
    padding: 24px 16px;
    overflow-x: auto;
    border: 1px solid rgba(25,34,64,0.6);
  }

  .mermaid svg { max-width: 100%; height: auto; }

  /* ===== Bottom Nav ===== */
  .bottom-nav {
    display: flex;
    justify-content: center;
    margin-top: 48px;
  }

  .bottom-nav-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 24px 40px;
    text-decoration: none;
    color: inherit;
    display: block;
    transition: all 0.3s;
    text-align: center;
  }

  .bottom-nav-card:hover {
    border-color: var(--border-focus);
    transform: translateY(-2px);
    box-shadow: 0 8px 32px rgba(74,158,255,0.08);
  }

  .bottom-nav-card .nav-dir {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 8px;
  }

  .bottom-nav-card h4 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text);
  }

  .bottom-nav-card p {
    font-size: 0.78rem;
    color: var(--text2);
    margin-top: 4px;
  }

  /* ===== Footer ===== */
  .footer {
    text-align: center;
    padding: 36px;
    border-top: 1px solid var(--border);
    color: var(--text3);
    font-size: 0.72rem;
    font-family: 'JetBrains Mono', monospace;
  }

  .footer a {
    color: var(--text3);
    text-decoration: none;
    transition: color 0.3s;
  }

  .footer a:hover { color: var(--blue); }

  /* ===== Repo Showcase ===== */
  .repo-showcase {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 24px;
  }

  .repo-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 14px;
    overflow: hidden;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  .repo-card:hover {
    border-color: var(--border-focus);
    box-shadow: 0 4px 24px rgba(74,158,255,0.06);
  }

  .repo-card-top {
    padding: 24px 24px 16px;
    border-bottom: 1px solid var(--border);
    position: relative;
  }

  .repo-card-top::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
  }

  .repo-card.theme-cyan .repo-card-top::before {
    background: linear-gradient(90deg, var(--cyan), rgba(34,211,238,0.2));
  }

  .repo-card.theme-green .repo-card-top::before {
    background: linear-gradient(90deg, var(--green), rgba(52,211,153,0.2));
  }

  .repo-name {
    font-size: 0.95rem;
    font-weight: 700;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .repo-name a {
    color: var(--text);
    text-decoration: none;
    transition: color 0.2s;
  }

  .repo-name a:hover { color: var(--cyan); }

  .repo-desc {
    font-size: 0.78rem;
    color: var(--text2);
    line-height: 1.6;
    margin-bottom: 14px;
  }

  .repo-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .repo-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.62rem;
    padding: 3px 10px;
    border-radius: 4px;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    white-space: nowrap;
  }

  .repo-badge.stars {
    color: var(--orange);
    background: rgba(251,191,36,0.08);
    border: 1px solid rgba(251,191,36,0.2);
  }

  .repo-badge.forks {
    color: var(--blue);
    background: rgba(74,158,255,0.08);
    border: 1px solid rgba(74,158,255,0.2);
  }

  .repo-badge.version {
    color: var(--green);
    background: rgba(52,211,153,0.08);
    border: 1px solid rgba(52,211,153,0.2);
  }

  .repo-badge.lang {
    color: var(--purple);
    background: rgba(167,139,250,0.08);
    border: 1px solid rgba(167,139,250,0.2);
  }

  .repo-badge.contribs {
    color: var(--teal);
    background: rgba(45,212,191,0.08);
    border: 1px solid rgba(45,212,191,0.2);
  }

  .repo-card-body { padding: 20px 24px; }

  .repo-agents {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 16px;
  }

  .agent-chip {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    padding: 3px 10px;
    border-radius: 20px;
    background: rgba(74,158,255,0.06);
    border: 1px solid rgba(74,158,255,0.15);
    color: var(--text2);
  }

  .agent-chip.primary {
    background: rgba(34,211,238,0.08);
    border-color: rgba(34,211,238,0.25);
    color: var(--cyan);
  }

  .repo-features {
    list-style: none;
    padding: 0;
  }

  .repo-features li {
    padding: 8px 0;
    border-bottom: 1px solid rgba(25,34,64,0.3);
    font-size: 0.78rem;
    color: var(--text2);
    display: flex;
    align-items: flex-start;
    gap: 8px;
    line-height: 1.5;
  }

  .repo-features li:last-child { border-bottom: none; }

  .feat-label {
    font-weight: 600;
    color: var(--text);
    white-space: nowrap;
    min-width: 64px;
  }

  .vs-banner {
    text-align: center;
    padding: 16px;
    margin: 8px 0 24px;
  }

  .vs-banner-inner {
    display: inline-flex;
    align-items: center;
    gap: 14px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--text3);
  }

  .vs-banner-inner::before,
  .vs-banner-inner::after {
    content: '';
    width: 60px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--border), transparent);
  }

  .quick-diff {
    display: grid;
    grid-template-columns: 160px 1fr 1fr;
    gap: 0;
    font-size: 0.78rem;
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 20px;
  }

  .quick-diff-header {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text2);
    background: var(--bg-card-alt);
    padding: 12px 16px;
    border-bottom: 2px solid var(--border);
  }

  .quick-diff-cell {
    padding: 10px 16px;
    border-bottom: 1px solid rgba(25,34,64,0.4);
    color: var(--text2);
    line-height: 1.5;
  }

  .quick-diff-cell:nth-child(3n+1) {
    font-weight: 600;
    color: var(--text);
    background: rgba(15,22,40,0.3);
  }

  .quick-diff-cell:nth-last-child(-n+3) { border-bottom: none; }

  .quick-diff-cell code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    padding: 1px 5px;
    border-radius: 3px;
    background: rgba(74,158,255,0.06);
    color: var(--cyan);
  }

  /* ===== Responsive ===== */
  @media (max-width: 768px) {
    .hero h1 { font-size: 2rem; }
    .hero { padding: 56px 20px 40px; }
    .container { padding: 32px 16px; }
    .op-grid { grid-template-columns: 1fr; }
    .compare-table { font-size: 0.72rem; }
    .compare-table thead th,
    .compare-table tbody td { padding: 10px 10px; }
    .card-body { padding: 16px; overflow-x: auto; }
    .repo-showcase { grid-template-columns: 1fr; }
    .quick-diff { grid-template-columns: 100px 1fr 1fr; font-size: 0.7rem; }
    .quick-diff-header,
    .quick-diff-cell { padding: 8px 10px; }
    .repo-card-top,
    .repo-card-body { padding: 16px; }
    .repo-stats { gap: 5px; }
    .repo-agents { gap: 4px; }
  }
</style>
</head>
<body>

<!-- ========== NAV ========== -->
<nav style="display:flex;justify-content:space-between;align-items:center;padding:12px 28px;border-bottom:1px solid #192240;background:#0b1120;font-family:'JetBrains Mono',monospace;font-size:0.75rem;">
  <a href="dev-standards.html" style="color:#8295b5;text-decoration:none;">&larr; 上一章</a>
  <a href="index.html" style="color:#4a5f80;text-decoration:none;">07 / 07 &middot; 返回主页</a>
  <span style="color:#4a5f80;">最终章</span>
</nav>

<!-- ========== HERO ========== -->
<div class="hero">
  <div class="hero-tag">CHAPTER 07 &middot; FINAL</div>
  <h1>进阶实战</h1>
  <p>多模型协作、自定义 MCP、成本优化、渐进式实践 &mdash;&mdash; 从理论到实战的最后一步。</p>
</div>

<div class="container">

<!-- ========== SECTION 01: 多模型协作 ========== -->
<div class="section">
  <div class="section-head">
    <span class="sn">01</span>
    <span class="st">多模型协作</span>
  </div>
  <p class="sd">不同 AI 模型各有所长。利用多工具/多模型协作，可以取长补短：一个模型负责实现，另一个负责审查。</p>

  <div class="card">
    <div class="card-head">
      <h3>模型能力对比矩阵</h3>
      <span class="card-badge">COMPARISON</span>
    </div>
    <div class="card-body">
      <div style="overflow-x:auto;">
        <table class="compare-table">
          <thead>
            <tr>
              <th>能力</th>
              <th>Claude</th>
              <th>GPT / Codex</th>
              <th>Gemini</th>
              <th>GLM</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>代码实现</td>
              <td class="highlight">最强</td>
              <td>优秀</td>
              <td>良好</td>
              <td>良好</td>
            </tr>
            <tr>
              <td>代码审查</td>
              <td>优秀</td>
              <td class="highlight">优秀</td>
              <td>良好</td>
              <td class="dim">中等</td>
            </tr>
            <tr>
              <td>长上下文</td>
              <td>200K</td>
              <td>128K</td>
              <td class="highlight">1M</td>
              <td>200K</td>
            </tr>
            <tr>
              <td>前端 / UI</td>
              <td>优秀</td>
              <td>良好</td>
              <td class="highlight">优秀</td>
              <td>良好</td>
            </tr>
            <tr>
              <td>推理 / 规划</td>
              <td class="highlight">最强</td>
              <td>优秀</td>
              <td>优秀</td>
              <td>良好</td>
            </tr>
            <tr>
              <td>价格</td>
              <td class="warn">高</td>
              <td>中等</td>
              <td class="highlight">低</td>
              <td class="highlight">最低</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-head">
      <h3>通用多模型协作工作流</h3>
      <span class="card-badge">WORKFLOW</span>
    </div>
    <div class="card-body">
      <p class="card-note">先按能力拆分，再并行执行，最后交叉审查与集成验证。</p>
      <div class="mermaid">
flowchart LR
    A["需求输入"] --> B["主控 Agent 拆解与路由"]
    B --> C1["实现 Agent<br/>后端 / 业务逻辑"]
    B --> C2["体验 Agent<br/>前端 / 交互"]
    B --> C3["检索 Agent<br/>文档 / 代码证据"]
    C1 --> D["主控 Agent 汇总变更"]
    C2 --> D
    C3 --> D
    D --> E["交叉审查"]
    E --> F["回归验证与交付"]
      </div>
    </div>
  </div>

  <!-- ===== 实战参考：仓库展示 ===== -->
  <div class="card">
    <div class="card-head">
      <h3>实战参考：项目级多 Agent 运行架构</h3>
      <span class="card-badge">PRACTICE</span>
    </div>
    <div class="card-body">
      <p class="card-note">两个开源仓库代表了当前 AI CLI 多 Agent 协作的两种主流范式 &mdash;&mdash; 一个是 OpenCode 插件编排层，一个是 Claude Code 原生 Team 协作流程。</p>

      <!-- ── 双仓库展示 ── -->
      <div class="repo-showcase">

        <!-- oh-my-opencode -->
        <div class="repo-card theme-cyan">
          <div class="repo-card-top">
            <div class="repo-name">
              <a href="https://github.com/code-yeongyu/oh-my-opencode" target="_blank" rel="noopener noreferrer">oh-my-opencode</a>
            </div>
            <div class="repo-desc">OpenCode 插件编排层 &mdash;&mdash; Sisyphus 主控 Agent 驱动的多模型协作系统，提供角色分工、后台并行、断点续跑、自动验证的完整工程闭环。</div>
            <div class="repo-stats">
              <span class="repo-badge stars">30.7k stars</span>
              <span class="repo-badge forks">2.3k forks</span>
              <span class="repo-badge version">v3.5.2</span>
              <span class="repo-badge lang">TypeScript</span>
              <span class="repo-badge contribs">204 contributors</span>
            </div>
          </div>
          <div class="repo-card-body">
            <div class="repo-agents">
              <span class="agent-chip primary">Sisyphus / Atlas 主控</span>
              <span class="agent-chip primary">Prometheus 规划</span>
              <span class="agent-chip">Hephaestus 实现</span>
              <span class="agent-chip">Frontend UI/UX</span>
              <span class="agent-chip">Librarian 文档</span>
              <span class="agent-chip">Explore 检索</span>
              <span class="agent-chip">Oracle 调试</span>
            </div>
            <ul class="repo-features">
              <li><span class="feat-label">编排模式</span>主控拆解需求 &rarr; 按专业角色分发 &rarr; 后台并行执行 &rarr; 汇总验证</li>
              <li><span class="feat-label">并行机制</span>任务拆解后同时启动 Explore / Librarian / Hephaestus / Frontend 等后台子任务</li>
              <li><span class="feat-label">隔离策略</span>按角色能力 + 工具权限隔离，主控仅做路由与汇总，保持精简上下文</li>
              <li><span class="feat-label">质量门禁</span>Todo Continuation Enforcer 强制未完成任务续跑，验证失败则自动迭代</li>
              <li><span class="feat-label">状态持久</span><code>.sisyphus/boulder.json</code> + 会话状态，支持 <code>/start-work</code> 断点恢复</li>
              <li><span class="feat-label">适用场景</span>复杂多文件改造、长链路任务、需要"做到完成"的工程项目</li>
            </ul>
          </div>
        </div>

        <!-- ccg-workflow -->
        <div class="repo-card theme-green">
          <div class="repo-card-top">
            <div class="repo-name">
              <a href="https://github.com/fengshao1227/ccg-workflow" target="_blank" rel="noopener noreferrer">ccg-workflow</a>
            </div>
            <div class="repo-desc">Claude + Codex + Gemini 多模型协作系统 &mdash;&mdash; Claude 编排决策，Codex 负责后端分析/审查，Gemini 负责前端分析/审查，提供 27+ 个斜杠命令。</div>
            <div class="repo-stats">
              <span class="repo-badge stars">2.3k stars</span>
              <span class="repo-badge forks">157 forks</span>
              <span class="repo-badge version">v1.7.60</span>
              <span class="repo-badge lang">Go + TypeScript</span>
              <span class="repo-badge contribs">4 contributors</span>
            </div>
          </div>
          <div class="repo-card-body">
            <div class="repo-agents">
              <span class="agent-chip primary">Claude Lead 编排</span>
              <span class="agent-chip primary">Codex 后端分析</span>
              <span class="agent-chip primary">Gemini 前端分析</span>
              <span class="agent-chip">Builder Teammates</span>
              <span class="agent-chip">codeagent-wrapper</span>
            </div>
            <ul class="repo-features">
              <li><span class="feat-label">编排模式</span>Claude Lead 编排，固定路由 Codex（后端）+ Gemini（前端）+ Claude（决策/代码）</li>
              <li><span class="feat-label">并行机制</span>Research/Plan 双模型并行分析；Exec 阶段按 Layer 并行 spawn Builder teammates</li>
              <li><span class="feat-label">隔离策略</span>计划阶段强制文件范围不重叠；有冲突则转依赖关系并串行化</li>
              <li><span class="feat-label">质量门禁</span><code>team-review</code> 双模型交叉审查，Critical/Warning/Info 分级，Critical 清零才能交付</li>
              <li><span class="feat-label">状态持久</span><code>.claude/team-plan/*.md</code> 文件传递状态，各阶段 <code>/clear</code> 隔离上下文</li>
              <li><span class="feat-label">适用场景</span>可拆为 3+ 独立模块、多人并行交付、需要明确责任边界的项目</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- ── 核心差异速查 ── -->
      <div class="vs-banner">
        <div class="vs-banner-inner">CORE DIFFERENCES</div>
      </div>

      <div class="quick-diff">
        <div class="quick-diff-header">维度</div>
        <div class="quick-diff-header">oh-my-opencode</div>
        <div class="quick-diff-header">ccg-workflow</div>

        <div class="quick-diff-cell">设计理念</div>
        <div class="quick-diff-cell">角色专精 &mdash; 每个 Agent 有独立能力边界与工具集</div>
        <div class="quick-diff-cell">模型专精 &mdash; 按模型特长固定路由（前端/后端/编排）</div>

        <div class="quick-diff-cell">Agent 数量</div>
        <div class="quick-diff-cell">7+ 专业子 Agent（Hephaestus / Frontend / Librarian / Explore / Oracle ...）</div>
        <div class="quick-diff-cell">3 核心模型 + 按需 spawn Builder teammates</div>

        <div class="quick-diff-cell">任务持续性</div>
        <div class="quick-diff-cell"><code>boulder.json</code> 状态持久化 + Todo Enforcer 强制续跑</div>
        <div class="quick-diff-cell">文件传递状态 + <code>/clear</code> 隔离，阶段间无状态耦合</div>

        <div class="quick-diff-cell">上手成本</div>
        <div class="quick-diff-cell">配置重，编排层功能多，需建立统一约束与提示词规范</div>
        <div class="quick-diff-cell">一键安装 <code>npx ccg-workflow</code>，命令式驱动，渐进式采用</div>

        <div class="quick-diff-cell">底层平台</div>
        <div class="quick-diff-cell">OpenCode（兼容 Claude Code Skills/Hooks/MCP）</div>
        <div class="quick-diff-cell">Claude Code CLI 原生（利用 Agent Teams 实验特性）</div>

        <div class="quick-diff-cell">风险点</div>
        <div class="quick-diff-cell">OAuth 访问受限争议；编排层复杂度高</div>
        <div class="quick-diff-cell">依赖 Agent Teams 实验能力；计划质量直接影响执行</div>
      </div>

      <!-- ── 架构流程图 ── -->
      <div class="op-grid">
        <div class="op-card cat-cyan">
          <h4>oh-my-opencode 架构流程</h4>
          <div class="mermaid">
flowchart TD
    classDef ctrl fill:#0d2847,stroke:#22d3ee,stroke-width:2px,color:#22d3ee
    classDef agent fill:#0f1628,stroke:#4a9eff,color:#dce4f0
    classDef state fill:#0f1628,stroke:#fbbf24,color:#fbbf24
    classDef gate fill:#0f1628,stroke:#34d399,color:#34d399

    REQ["&#x1F4E5; 需求输入"] --> CTRL["Sisyphus / Atlas<br/>主控编排"]
    CTRL --> PLAN["Prometheus<br/>任务规划"]
    PLAN --> EXEC["&#x1F680; /start-work<br/>分发执行"]

    EXEC --> |并行| EXP["Explore<br/>代码检索"]
    EXEC --> |并行| LIB["Librarian<br/>文档检索"]
    EXEC --> |并行| HEP["Hephaestus<br/>后端实现"]
    EXEC --> |并行| FE["Frontend<br/>UI 实现"]
    EXEC --> |并行| ORA["Oracle<br/>设计/调试"]

    EXP --> MERGE["&#x1F4CB; 主控汇总变更"]
    LIB --> MERGE
    HEP --> MERGE
    FE --> MERGE
    ORA --> MERGE

    MERGE --> VERIFY{"&#x2705; 验证通过？"}
    VERIFY -- "是" --> DONE["&#x2714; 交付"]
    VERIFY -- "否" --> ENFORCE["Todo Enforcer<br/>强制续跑"]
    ENFORCE --> EXEC

    BOULDER["&#x1F4BE; boulder.json<br/>状态持久化"] -.-> EXEC
    BOULDER -.-> ENFORCE

    class CTRL,PLAN ctrl
    class EXP,LIB,HEP,FE,ORA agent
    class BOULDER state
    class VERIFY,DONE,ENFORCE gate
          </div>
          <div class="insight" style="margin-top:16px;">
            <h4>核心机制</h4>
            <p><strong>角色分工 + 后台并行 + 状态闭环</strong> &mdash;&mdash; 主控 Agent 不做具体实现，只负责拆解、分发、汇总。每个子 Agent 有独立工具权限和能力边界，后台并行执行。boulder.json 记录全局状态，Todo Continuation Enforcer 在验证未通过时强制续跑，确保任务"做到完成"。</p>
          </div>
        </div>

        <div class="op-card cat-green">
          <h4>ccg-workflow 架构流程</h4>
          <div class="mermaid">
flowchart TD
    classDef lead fill:#0d2847,stroke:#34d399,stroke-width:2px,color:#34d399
    classDef model fill:#0f1628,stroke:#a78bfa,color:#dce4f0
    classDef builder fill:#0f1628,stroke:#4a9eff,color:#4a9eff
    classDef gate fill:#0f1628,stroke:#fbbf24,color:#fbbf24
    classDef phase fill:#0d2847,stroke:#22d3ee,color:#22d3ee

    REQ["&#x1F4E5; 需求输入"] --> LEAD["Claude Lead<br/>编排决策"]

    LEAD --> RES["&#x1F50D; Phase 1: Research"]
    RES --> |并行| CODEX_R["Codex<br/>后端分析"]
    RES --> |并行| GEMINI_R["Gemini<br/>前端分析"]
    CODEX_R --> PLAN["&#x1F4D0; Phase 2: Plan"]
    GEMINI_R --> PLAN

    PLAN --> EXEC["&#x1F680; Phase 3: Exec"]
    EXEC --> |并行| B1["Builder 1<br/>Layer A"]
    EXEC --> |并行| B2["Builder 2<br/>Layer B"]
    EXEC --> |并行| BN["Builder N<br/>Layer ..."]

    B1 --> REV["&#x1F50E; Phase 4: Review"]
    B2 --> REV
    BN --> REV
    REV --> |并行| CODEX_V["Codex 审查"]
    REV --> |并行| GEMINI_V["Gemini 审查"]

    CODEX_V --> GATE{"Critical = 0 ?"}
    GEMINI_V --> GATE
    GATE -- "否" --> FIX["&#x1F527; 修复 Critical"]
    FIX --> REV
    GATE -- "是" --> DONE["&#x2714; 交付"]

    ISO["&#x1F4C1; 文件范围隔离<br/>依赖分层"] -.-> EXEC
    STATE["&#x1F4DD; team-plan/*.md<br/>状态传递"] -.-> RES
    STATE -.-> PLAN
    STATE -.-> EXEC
    STATE -.-> REV

    class LEAD lead
    class CODEX_R,GEMINI_R,CODEX_V,GEMINI_V model
    class B1,B2,BN builder
    class GATE,FIX gate
    class RES,PLAN,EXEC,REV phase
          </div>
          <div class="insight" style="margin-top:16px;">
            <h4>核心机制</h4>
            <p><strong>模型专精 + 阶段隔离 + 交叉审查</strong> &mdash;&mdash; Claude 做编排决策和代码实现，Codex 专注后端分析/审查，Gemini 专注前端分析/审查。每个阶段通过 <code>/clear</code> 隔离上下文，用 <code>team-plan/*.md</code> 文件传递状态。Exec 阶段按文件范围隔离 spawn 多个 Builder 并行实施，Review 阶段双模型交叉审查确保质量。</p>
          </div>
        </div>
      </div>

      <!-- ── 选型建议 ── -->
      <div class="insight" style="margin-top:8px;">
        <h4>如何选择？</h4>
        <p>
          <strong>选 oh-my-opencode</strong> &mdash;&mdash; 如果你使用 OpenCode、需要长时间自主运行的 Agent、偏好角色分工式的专业化协作、项目需要断点续跑能力。<br/>
          <strong>选 ccg-workflow</strong> &mdash;&mdash; 如果你使用 Claude Code CLI、项目可按模块拆分并行、需要快速上手（<code>npx</code> 一键）、偏好阶段式 Research &rarr; Plan &rarr; Exec &rarr; Review 流程。<br/>
          两者并非互斥：oh-my-opencode 侧重"Agent 自主完成"，ccg-workflow 侧重"人机协作编排"。根据项目复杂度和团队习惯选择。
        </p>
      </div>
    </div>
  </div>
</div>

<!-- ========== SECTION 02: 自定义 MCP Server 开发 ========== -->
<div class="section">
  <div class="section-head">
    <span class="sn">02</span>
    <span class="st">自定义 MCP Server 开发</span>
  </div>
  <p class="sd">当现有 MCP Server 不满足需求时，可以自己开发。MCP 协议使用 JSON-RPC 2.0，支持 TypeScript / Python 实现。</p>

  <div class="card">
    <div class="card-head">
      <h3>最小 MCP Server 模板</h3>
      <span class="card-badge">TEMPLATE</span>
    </div>
    <div class="card-body">
      <p class="card-note">使用 @modelcontextprotocol/sdk 快速搭建自定义 MCP Server</p>
      <div class="spec-block">
        <div class="spec-block-head">
          <span>my-mcp-server/index.ts</span>
          <span class="spec-lang">TYPESCRIPT</span>
        </div>
        <pre><span class="comment">// my-mcp-server/index.ts</span>
<span class="keyword">import</span> { Server } <span class="keyword">from</span> <span class="str">"@modelcontextprotocol/sdk/server"</span>;
<span class="keyword">import</span> { StdioServerTransport } <span class="keyword">from</span> <span class="str">"@modelcontextprotocol/sdk/server/stdio"</span>;

<span class="keyword">const</span> <span class="key">server</span> = <span class="keyword">new</span> Server({
  <span class="key">name</span>: <span class="str">"my-custom-server"</span>,
  <span class="key">version</span>: <span class="str">"1.0.0"</span>
}, {
  <span class="key">capabilities</span>: { <span class="key">tools</span>: {} }
});

<span class="comment">// 定义工具</span>
server.setRequestHandler(<span class="str">"tools/list"</span>, <span class="keyword">async</span> () =&gt; ({
  <span class="key">tools</span>: [{
    <span class="key">name</span>: <span class="str">"my_tool"</span>,
    <span class="key">description</span>: <span class="str">"自定义工具描述"</span>,
    <span class="key">inputSchema</span>: {
      <span class="key">type</span>: <span class="str">"object"</span>,
      <span class="key">properties</span>: {
        <span class="key">query</span>: { <span class="key">type</span>: <span class="str">"string"</span>, <span class="key">description</span>: <span class="str">"查询参数"</span> }
      },
      <span class="key">required</span>: [<span class="str">"query"</span>]
    }
  }]
}));

<span class="comment">// 实现工具</span>
server.setRequestHandler(<span class="str">"tools/call"</span>, <span class="keyword">async</span> (request) =&gt; {
  <span class="keyword">if</span> (request.params.name === <span class="str">"my_tool"</span>) {
    <span class="keyword">const</span> { query } = request.params.arguments;
    <span class="comment">// 你的自定义逻辑</span>
    <span class="keyword">return</span> { <span class="key">content</span>: [{ <span class="key">type</span>: <span class="str">"text"</span>, <span class="key">text</span>: <span class="str">`结果: ${query}`</span> }] };
  }
});

<span class="comment">// 启动</span>
<span class="keyword">const</span> <span class="key">transport</span> = <span class="keyword">new</span> StdioServerTransport();
<span class="keyword">await</span> server.connect(transport);</pre>
      </div>
    </div>
  </div>

  <div class="op-grid">
    <div class="op-card cat-blue">
      <h4>开发步骤</h4>
      <ul class="op-list">
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">定义工具</span><br><span class="op-desc">明确工具名称、描述、输入参数</span></div>
        </li>
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">实现逻辑</span><br><span class="op-desc">处理请求并返回结果</span></div>
        </li>
        <li>
          <span class="freq-mid">&#9733;&#9733;</span>
          <div><span class="op-name">本地测试</span><br><span class="op-desc">使用 MCP Inspector 调试</span></div>
        </li>
        <li>
          <span class="freq-mid">&#9733;&#9733;</span>
          <div><span class="op-name">配置集成</span><br><span class="op-desc">添加到 AI 工具的 MCP 配置</span></div>
        </li>
        <li>
          <span class="freq-low">&#9733;</span>
          <div><span class="op-name">发布分享</span><br><span class="op-desc">发布到 npm，供社区使用</span></div>
        </li>
      </ul>
    </div>
    <div class="op-card cat-purple">
      <h4>常见自定义场景</h4>
      <ul class="op-list">
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">内部 API</span><br><span class="op-desc">连接公司内部系统</span></div>
        </li>
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">特定数据源</span><br><span class="op-desc">对接私有数据库或数据仓库</span></div>
        </li>
        <li>
          <span class="freq-mid">&#9733;&#9733;</span>
          <div><span class="op-name">工作流自动化</span><br><span class="op-desc">自动化部署、测试、通知等</span></div>
        </li>
        <li>
          <span class="freq-mid">&#9733;&#9733;</span>
          <div><span class="op-name">领域工具</span><br><span class="op-desc">行业特定的工具集成</span></div>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- ========== SECTION 03: 成本控制与 Token 优化 ========== -->
<div class="section">
  <div class="section-head">
    <span class="sn">03</span>
    <span class="st">成本控制与 Token 优化</span>
  </div>
  <p class="sd">Token 成本 = 输入 Token + 输出 Token（输出单价约为输入的 5 倍）。通过 Skills 精简、子 Agent 上下文隔离、智能模型路由三大维度组合优化，可实现 60-80% 的成本降幅。</p>

  <!-- ── 区块 1: Token 优化策略总览表 ── -->
  <div class="card">
    <div class="card-head">
      <h3>Token 优化策略总览</h3>
      <span class="card-badge">STRATEGY</span>
    </div>
    <div class="card-body">
      <div style="overflow-x:auto;">
        <table class="compare-table">
          <thead>
            <tr>
              <th>维度</th>
              <th>策略</th>
              <th>说明</th>
              <th>节省效果</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span style="color:var(--cyan);font-weight:600;">Skills 精简</span></td>
              <td>MCP Server 裁剪</td>
              <td>每个启用的 MCP 都注入系统提示词，即使从未调用也占 Token</td>
              <td class="highlight">高</td>
            </tr>
            <tr>
              <td><span style="color:var(--cyan);font-weight:600;">Skills 精简</span></td>
              <td>CLAUDE.md 分层</td>
              <td>根级精简 + 模块级详尽，模型只加载工作目录链上的文件</td>
              <td class="highlight">中</td>
            </tr>
            <tr>
              <td><span style="color:var(--cyan);font-weight:600;">Skills 精简</span></td>
              <td>/compact 压缩</td>
              <td>窗口占用 80% 时手动压缩或新建会话</td>
              <td class="highlight">高</td>
            </tr>
            <tr>
              <td><span style="color:var(--purple);font-weight:600;">子 Agent 隔离</span></td>
              <td>子 Agent 委派</td>
              <td>子 Agent 只接收精确任务描述，不继承主会话上下文</td>
              <td class="highlight">高</td>
            </tr>
            <tr>
              <td><span style="color:var(--purple);font-weight:600;">子 Agent 隔离</span></td>
              <td>精确调用描述</td>
              <td>精确描述比模糊多次重试节省 3-5x Token</td>
              <td class="highlight">高</td>
            </tr>
            <tr>
              <td><span style="color:var(--purple);font-weight:600;">子 Agent 隔离</span></td>
              <td>子 Agent 模型降级</td>
              <td>环境变量 / settings.json 指定 Haiku/Sonnet</td>
              <td class="highlight">高</td>
            </tr>
            <tr>
              <td><span style="color:var(--green);font-weight:600;">模型路由</span></td>
              <td>任务复杂度路由</td>
              <td>Sonnet 日常编码 + Opus 架构设计，按需选模型</td>
              <td class="highlight">高</td>
            </tr>
            <tr>
              <td><span style="color:var(--green);font-weight:600;">模型路由</span></td>
              <td>输出 Token 控制</td>
              <td>Prompt 中指定"简洁回答"，输出成本是输入 5x</td>
              <td class="highlight">高</td>
            </tr>
            <tr>
              <td><span style="color:var(--green);font-weight:600;">模型路由</span></td>
              <td>上下文压缩</td>
              <td>长文档先摘要再注入，节省 90% 输入 Token</td>
              <td class="highlight">中</td>
            </tr>
            <tr>
              <td><span style="color:var(--green);font-weight:600;">模型路由</span></td>
              <td>BYOK + OpenCode</td>
              <td>自带 API Key，利用 Prompt Cache 降低重复计算</td>
              <td class="highlight">高</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ── 区块 2: 三大维度详解 ── -->
  <div class="card">
    <div class="card-head">
      <h3>三大优化维度详解</h3>
      <span class="card-badge">DEEP DIVE</span>
    </div>
    <div class="card-body">
      <div class="op-grid">
        <div class="op-card cat-cyan">
          <h4>Skills 精简</h4>
          <ul class="op-list">
            <li>
              <span class="freq-high">&#9733;&#9733;&#9733;</span>
              <div><span class="op-name">MCP Server 裁剪</span><br><span class="op-desc">每个启用的 MCP 都向系统提示词注入工具描述，即使从未调用也持续消耗 Token。只保留当前任务需要的 MCP</span></div>
            </li>
            <li>
              <span class="freq-high">&#9733;&#9733;&#9733;</span>
              <div><span class="op-name">CLAUDE.md 分层管理</span><br><span class="op-desc">根级文件精简（&lt;50 行），模块级文件放详细规范。模型只加载当前工作目录到根目录链上的 CLAUDE.md</span></div>
            </li>
            <li>
              <span class="freq-mid">&#9733;&#9733;</span>
              <div><span class="op-name">Skills 按需加载</span><br><span class="op-desc">高频 Skill 保持启用，低频 Skill 通过 /slash-command 按需调用，避免系统提示词膨胀</span></div>
            </li>
            <li>
              <span class="freq-mid">&#9733;&#9733;</span>
              <div><span class="op-name">目录级屏蔽</span><br><span class="op-desc">CLAUDE.md 中明确禁止扫描 node_modules / dist / .git 等目录，避免无意义的上下文索引</span></div>
            </li>
            <li>
              <span class="freq-high">&#9733;&#9733;&#9733;</span>
              <div><span class="op-name">/compact + 80% 规则</span><br><span class="op-desc">上下文窗口占用超过 80% 时执行 /compact 压缩或新建会话，防止累积 Token 爆炸</span></div>
            </li>
          </ul>
        </div>
        <div class="op-card cat-purple">
          <h4>子 Agent 上下文隔离</h4>
          <ul class="op-list">
            <li>
              <span class="freq-high">&#9733;&#9733;&#9733;</span>
              <div><span class="op-name">主控编排 + 子 Agent 执行</span><br><span class="op-desc">主会话保持干净的编排角色，具体实现委派给子 Agent，主上下文不膨胀</span></div>
            </li>
            <li>
              <span class="freq-high">&#9733;&#9733;&#9733;</span>
              <div><span class="op-name">上下文不继承</span><br><span class="op-desc">子 Agent 只接收精确的任务描述（prompt 参数），天然隔离主会话的历史 Token</span></div>
            </li>
            <li>
              <span class="freq-high">&#9733;&#9733;&#9733;</span>
              <div><span class="op-name">调用质量 &gt; 数量</span><br><span class="op-desc">精确描述一次到位，比模糊描述多次重试节省 3-5x Token 消耗</span></div>
            </li>
            <li>
              <span class="freq-mid">&#9733;&#9733;</span>
              <div><span class="op-name">并行 vs 串行策略</span><br><span class="op-desc">独立任务并行执行（各自上下文隔离），有依赖的任务串行传递最小上下文</span></div>
            </li>
            <li>
              <span class="freq-high">&#9733;&#9733;&#9733;</span>
              <div><span class="op-name">子 Agent 模型降级</span><br><span class="op-desc">通过环境变量或 settings.json 将子 Agent 指定为 Haiku/Sonnet，大幅降低执行成本</span></div>
            </li>
          </ul>
        </div>
        <div class="op-card cat-green">
          <h4>智能模型路由</h4>
          <ul class="op-list">
            <li>
              <span class="freq-high">&#9733;&#9733;&#9733;</span>
              <div><span class="op-name">Sonnet 日常 + Opus 架构</span><br><span class="op-desc">日常编码用 Sonnet（性价比最优），架构设计 / 复杂重构用 Opus</span></div>
            </li>
            <li>
              <span class="freq-high">&#9733;&#9733;&#9733;</span>
              <div><span class="op-name">输出 Token 控制</span><br><span class="op-desc">输出成本是输入的 5 倍。在 Prompt 中指定"简洁回答 / 只输出代码"可显著降低输出 Token</span></div>
            </li>
            <li>
              <span class="freq-mid">&#9733;&#9733;</span>
              <div><span class="op-name">历史裁剪</span><br><span class="op-desc">只保留最近 N 条消息，丢弃已完成任务的历史上下文</span></div>
            </li>
            <li>
              <span class="freq-high">&#9733;&#9733;&#9733;</span>
              <div><span class="op-name">上下文压缩</span><br><span class="op-desc">长文档先用小模型摘要再注入主上下文，节省 90% 输入 Token</span></div>
            </li>
            <li>
              <span class="freq-mid">&#9733;&#9733;</span>
              <div><span class="op-name">Prompt Cache</span><br><span class="op-desc">保持系统提示词稳定不变以命中缓存，缓存命中时输入成本降低 90%</span></div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ── 区块 3: 实战配置示例 ── -->
  <div class="card">
    <div class="card-head">
      <h3>实战配置示例</h3>
      <span class="card-badge">CONFIG</span>
    </div>
    <div class="card-body">
      <div class="spec-block">
        <div class="spec-block-head">
          <span>CLAUDE.md 分层结构</span>
          <span class="spec-lang">STRUCTURE</span>
        </div>
        <pre><span class="comment"># CLAUDE.md 分层策略 — 根级精简，模块级详尽</span>

<span class="key">project-root/</span>
  <span class="key">CLAUDE.md</span>              <span class="comment"># 根级：&lt;50 行，仅项目级约束</span>
  <span class="str">├── tech-stack: Next.js + TypeScript</span>
  <span class="str">├── code-style: eslint + prettier</span>
  <span class="str">├── 禁止扫描: node_modules/, dist/, .git/</span>
  <span class="str">└── 模型偏好: 日常 Sonnet, 架构 Opus</span>

  <span class="key">src/</span>
    <span class="key">CLAUDE.md</span>            <span class="comment"># 模块级：详细组件规范 + API 约定</span>
    <span class="key">components/</span>
      <span class="key">CLAUDE.md</span>          <span class="comment"># 子模块级：组件命名 + 样式约定</span>

<span class="comment"># 模型只加载 当前目录 → 根目录 链上的 CLAUDE.md</span>
<span class="comment"># 在 src/components/ 工作时，加载 3 个文件</span>
<span class="comment"># 在 project-root/ 工作时，只加载 1 个文件</span></pre>
      </div>
      <div class="spec-block">
        <div class="spec-block-head">
          <span>子 Agent 模型降级配置</span>
          <span class="spec-lang">BASH</span>
        </div>
        <pre><span class="comment"># 方式 1: 环境变量 — 全局生效</span>
<span class="keyword">export</span> <span class="key">CLAUDE_CODE_DEFAULT_MODEL</span>=<span class="str">"claude-sonnet-4-20250514"</span>
<span class="keyword">export</span> <span class="key">ANTHROPIC_SMALL_FAST_MODEL</span>=<span class="str">"claude-haiku-3-5-20241022"</span>

<span class="comment"># 方式 2: settings.json — 项目级生效</span>
<span class="comment"># .claude/settings.json</span>
{
  <span class="key">"preferences"</span>: {
    <span class="str">"model"</span>: <span class="str">"claude-sonnet-4-20250514"</span>,
    <span class="str">"smallFastModel"</span>: <span class="str">"claude-haiku-3-5-20241022"</span>
  }
}

<span class="comment"># 方式 3: Task tool 指定 — 单次调用降级</span>
<span class="comment"># 在 Task 调用中指定 model 参数</span>
<span class="key">model:</span> <span class="str">"haiku"</span>   <span class="comment"># 适用于格式化、搜索、简单重构</span>
<span class="key">model:</span> <span class="str">"sonnet"</span>  <span class="comment"># 适用于日常编码、测试编写</span>
<span class="key">model:</span> <span class="str">"opus"</span>    <span class="comment"># 适用于架构设计、复杂重构</span></pre>
      </div>
      <div class="spec-block">
        <div class="spec-block-head">
          <span>输出 Token 控制指令</span>
          <span class="spec-lang">PROMPT</span>
        </div>
        <pre><span class="comment"># 在 CLAUDE.md 中添加输出控制指令</span>

<span class="key">## Response Rules</span>
<span class="str">- 回答简洁，先给结论</span>
<span class="str">- 代码修改只输出 diff，不要输出完整文件</span>
<span class="str">- 不要添加不必要的注释和文档字符串</span>
<span class="str">- 不要解释已知概念</span>
<span class="str">- 如果只改 1-2 行，用 Edit tool 而不是 Write tool</span>

<span class="comment"># 在具体 prompt 中控制输出</span>
<span class="value">"只返回修改后的函数，不要解释"</span>
<span class="value">"用 bullet points 总结，不超过 5 条"</span>
<span class="value">"给出命令，不需要解释每个参数"</span></pre>
      </div>
    </div>
  </div>

  <!-- ── 区块 4: 月度成本估算（增强版） ── -->
  <div class="card">
    <div class="card-head">
      <h3>月度成本估算</h3>
      <span class="card-badge">COST</span>
    </div>
    <div class="card-body">
      <p class="card-note">基于重度使用场景（每天 4-6 小时）的估算，优化后为应用三大维度策略的效果</p>
      <div style="overflow-x:auto;">
        <table class="compare-table">
          <thead>
            <tr>
              <th>方案</th>
              <th>原始成本</th>
              <th>优化后</th>
              <th>节省</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Claude Code Max（订阅）</td>
              <td>$200/月</td>
              <td>$200/月</td>
              <td class="dim">固定费用，优化延长可用量</td>
            </tr>
            <tr>
              <td>Claude Code Pro（订阅）</td>
              <td>$20/月</td>
              <td>$20/月</td>
              <td class="dim">固定费用，优化减少触顶频率</td>
            </tr>
            <tr>
              <td>Cursor Pro（订阅）</td>
              <td>$20/月</td>
              <td>$20/月</td>
              <td class="dim">固定费用，优化延长快速请求额度</td>
            </tr>
            <tr>
              <td>OpenCode + API（按量）</td>
              <td>$150/月</td>
              <td>$30-60/月</td>
              <td class="highlight">60-80%</td>
            </tr>
            <tr>
              <td>GLM Plan（按量）</td>
              <td>$30/月</td>
              <td>$10-15/月</td>
              <td class="highlight">50-67%</td>
            </tr>
            <tr>
              <td>Gemini CLI（按量）</td>
              <td>$50/月</td>
              <td>$0-20/月</td>
              <td class="highlight">60-100%</td>
            </tr>
          </tbody>
        </table>
      </div>
      <p class="card-note" style="margin-top:14px;margin-bottom:0;">订阅制：优化策略不降账单，但延长额度可用时长 | 按量制（API）：优化直接降低账单，效果立竿见影</p>
    </div>
  </div>

  <!-- ── 区块 5: Insight ── -->
  <div class="insight">
    <h4>Token 优化的 80/20 法则</h4>
    <p>80% 的 Token 浪费来自三个源头：<strong style="color:var(--cyan);">未裁剪的 MCP 系统提示词</strong>持续注入每次请求；<strong style="color:var(--purple);">主 Agent 累积的子任务执行细节</strong>撑满上下文窗口；<strong style="color:var(--green);">简单任务使用重型模型</strong>产生高额输出 Token 费用。</p>
    <p style="margin-top:10px;">三步优先行动：<strong>1.</strong> 裁剪闲置 MCP Server &rarr; <strong>2.</strong> 复杂任务委派子 Agent &rarr; <strong>3.</strong> 日常编码切换 Sonnet。仅这三步即可覆盖大部分优化收益。</p>
  </div>
</div>

<!-- ========== SECTION 04: 从单文件到全项目的渐进式实践 ========== -->
<div class="section">
  <div class="section-head">
    <span class="sn">04</span>
    <span class="st">从单文件到全项目的渐进式实践</span>
  </div>
  <p class="sd">不要试图一步到位。从最简单的单文件操作开始，逐步扩展到多 Agent 协作和全自动工作流。</p>

  <div class="card">
    <div class="card-head">
      <h3>渐进式实践路线图</h3>
      <span class="card-badge">ROADMAP</span>
    </div>
    <div class="card-body">
      <div class="mermaid">
flowchart TD
    L1["Level 1: 单文件操作&lt;br/&gt;补全 · 重构 · Bug 修复"] --> L2["Level 2: 模块级开发&lt;br/&gt;功能模块 · 测试编写"]
    L2 --> L3["Level 3: 项目级编排&lt;br/&gt;多文件变更 · PR 生成"]
    L3 --> L4["Level 4: 多 Agent 协作&lt;br/&gt;并行开发 · 交叉审查"]
    L4 --> L5["Level 5: 全自动工作流&lt;br/&gt;CI/CD 集成 · 自主修复"]
      </div>
    </div>
  </div>

  <div class="op-grid">
    <div class="op-card cat-blue">
      <h4>Level 1 &middot; 单文件</h4>
      <ul class="op-list">
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">代码补全</span><br><span class="op-desc">使用 AI 补全函数实现</span></div>
        </li>
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">重构</span><br><span class="op-desc">让 AI 优化现有代码</span></div>
        </li>
        <li>
          <span class="freq-mid">&#9733;&#9733;</span>
          <div><span class="op-name">Bug 修复</span><br><span class="op-desc">描述 bug，AI 定位并修复</span></div>
        </li>
        <li>
          <span class="freq-low">&#9733;</span>
          <div><span class="op-name">文档</span><br><span class="op-desc">AI 生成 JSDoc / 注释</span></div>
        </li>
      </ul>
    </div>
    <div class="op-card cat-purple">
      <h4>Level 2 &middot; 模块级</h4>
      <ul class="op-list">
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">功能模块</span><br><span class="op-desc">描述功能需求，AI 生成完整模块</span></div>
        </li>
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">测试编写</span><br><span class="op-desc">AI 生成单元测试</span></div>
        </li>
        <li>
          <span class="freq-mid">&#9733;&#9733;</span>
          <div><span class="op-name">API 端点</span><br><span class="op-desc">从 Schema 生成 CRUD</span></div>
        </li>
      </ul>
    </div>
    <div class="op-card cat-green">
      <h4>Level 3 &middot; 项目级</h4>
      <ul class="op-list">
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">多文件变更</span><br><span class="op-desc">一次 prompt 修改多个文件</span></div>
        </li>
        <li>
          <span class="freq-mid">&#9733;&#9733;</span>
          <div><span class="op-name">PR 生成</span><br><span class="op-desc">AI 自动提交 PR</span></div>
        </li>
        <li>
          <span class="freq-mid">&#9733;&#9733;</span>
          <div><span class="op-name">架构迁移</span><br><span class="op-desc">AI 辅助技术栈迁移</span></div>
        </li>
      </ul>
    </div>
    <div class="op-card cat-orange">
      <h4>Level 4 &middot; 多 Agent</h4>
      <ul class="op-list">
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">并行开发</span><br><span class="op-desc">多子 Agent 同时开发不同模块</span></div>
        </li>
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">交叉审查</span><br><span class="op-desc">不同模型互相审查</span></div>
        </li>
        <li>
          <span class="freq-mid">&#9733;&#9733;</span>
          <div><span class="op-name">任务分解</span><br><span class="op-desc">自动拆解大任务</span></div>
        </li>
      </ul>
    </div>
    <div class="op-card cat-cyan">
      <h4>Level 5 &middot; 全自动</h4>
      <ul class="op-list">
        <li>
          <span class="freq-high">&#9733;&#9733;&#9733;</span>
          <div><span class="op-name">CI/CD 集成</span><br><span class="op-desc">GitHub Actions + AI 自动修复</span></div>
        </li>
        <li>
          <span class="freq-mid">&#9733;&#9733;</span>
          <div><span class="op-name">监控响应</span><br><span class="op-desc">AI 自动响应错误报警</span></div>
        </li>
        <li>
          <span class="freq-low">&#9733;</span>
          <div><span class="op-name">自主运维</span><br><span class="op-desc">自动化部署和回滚</span></div>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- ========== 结尾 Insight ========== -->
<div class="section">
  <div class="insight">
    <h4>持续进化</h4>
    <p>AI CLI 工具的能力在快速迭代。今天的最佳实践可能半年后就会被更好的方法取代。保持学习和实验的心态，关注工具更新日志，参与社区讨论，不断优化你的 AI 辅助工作流。记住：AI 是工具，工程判断力才是不可替代的核心能力。</p>
  </div>
</div>

<!-- ========== BOTTOM NAV ========== -->
<div class="bottom-nav">
  <a href="index.html" class="bottom-nav-card">
    <div class="nav-dir">&#127968; 返回主页</div>
    <h4>AI CLI 工具通识教学</h4>
    <p>回到教程目录，浏览全部章节</p>
  </a>
</div>

</div>

<!-- ========== FOOTER ========== -->
<div class="footer">
  AI CLI TOOLS TUTORIAL &middot; CHAPTER 07 &middot; 2026 &middot; <a href="index.html">返回主页</a>
</div>

<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark',
    securityLevel: 'loose',
    flowchart: { useMaxWidth: true, htmlLabels: true, curve: 'basis' },
    sequence: { useMaxWidth: true, mirrorActors: false }
  });
</script>
</body>
</html>
